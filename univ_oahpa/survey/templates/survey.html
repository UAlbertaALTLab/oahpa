{% extends 'univ_oahpa.html' %}

{% load i18n %}
{% load goal_filters %}
{% load staticfiles %}

{% get_current_language as LANGUAGE_CODE %}

{% block main_js %}{% endblock %}

{% block extrajs %}
    <link rel="stylesheet" type="text/css" href="{% static "css/bootstrap-theme.css" %}"/>
    <link rel="stylesheet" type="text/css" href="{% static "css/bootstrap_namespaced.css" %}"/>
    <link rel="stylesheet" type="text/css" href="{% static "css/surveys.css" %}"/>

	<script src="{% static "js/angular.min.js" %}"     type="text/javascript"></script>
	<script src="{% static "js/angular-cookies.js" %}" type="text/javascript"></script>
	<script src="{% static "js/surveys.js" %}"         type="text/javascript"></script> 
{% endblock %}

{% block page_class %}fixed{% endblock %}
{% block imgprefix %}numra{% endblock %}

{% block content %}
    <div id="surveys" ng-app="Surveys" class="bootstrap-styles">
        <div ng-controller="SurveyClient" ng-source="/{{ URL_PREFIX }}/survey/api/">
            <div class="col-lg-9 col-sm-9 col-md-9">

                <form novalidate ng-show="results" 
                                 ng-submit="submitForm($event)" 
                                 id="new_goal"
                                 target="/{{ URL_PREFIX }}/survey/api/answers/"
                                 ng-hide="form_succcess && results" 
                                 role="form">

                    <div class="row" ng-repeat="survey in surveys">

                        <div class="col-md-1">
                            <span class="step_number">1</span>
                        </div>

                        <div class="col-md-11">
                            <h3><% survey.title %></h3>
                            <blockquote><p><% survey.description %></p></blockquote>
                            <h5>Questions:</h5>
                            <div ng-repeat="question in survey.questions">
                                <div class="form-group">
                                    {% comment %}
                                    <pre><% question %></pre>
                                    {% endcomment %}
                                    <label class="required-<% question.required %>" for=""><% question.question_text %></label>

                                    <textarea class="form-control"
                                           ng-if="question.question_type == 'text'"
                                           name="question.question_id"
                                           ng-required="question.required"
                                           ng-model="survey_answers[survey.id][question.id]">
                                       </textarea>

                                       <select class="form-control required-<% question.required %>"
                                            id="selectMainType"
                                            name="main_type"
                                            ng-if="question.question_type == 'choice'"
                                            ng-required="question.required"
                                            ng-options="a.id as a.answer_text for a in question.answer_values"
                                            ng-model="survey_answers[survey.id][question.id]">

                                    </select>

                                    <hr />
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="row">

                        <div class="col-md-1">
                            <span class="step_number">&nbsp;</span>
                        </div>

                        <div class="col-md-11">
                            <button type="button" ng-click="submitForm()" class="btn btn-info">Submit</button>
                            <button type="button" class="btn btn-warning">Reset</button>
                        </div>
                    </div>
                </form>

                {# TODO: response processing #}
                <pre><% survey_answers %></pre>
                <h4>response</h4>

                {# TODO: success #}
                <pre><% survey_answers %></pre>
                <h5 ng-if="success">success</h5>

            </div>
        </div>
    </div>

{% endblock %}

{# vim: set ts=4 sw=4 tw=0 syntax=htmldjango : #}
