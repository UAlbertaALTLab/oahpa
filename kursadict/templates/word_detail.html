{% extends 'base.html' %}

{% block extra_css %}
<link href="{{url_for('static', filename='css/detail.css')}}" rel="stylesheet" />
<!-- <script type="text/javascript" src="{{url_for('static', filename='js/dropdown-button.js')}}"></script> -->
<script type="text/javascript">
  $(document).ready( function() {
   $(document).find('#langpairs li a').click(function(obj) {
     var elem    = $(obj.target).parent('a');
     var new_val = $(obj.target).attr('data-value') ||
                   $(elem).attr('data-value') ;
     var _from = new_val.slice(0, 3)
       , _to   = new_val.slice(3, 6)
       ;
     var _url   = "/" + (_from) + "/" + (_to) + "/"
       , _label = "" + (_from) + "->" + (_to)
       ;
     $(document).find('#neahttadigisanit button span.val_name').html(_label);
     $(document).find('#neahttadigisanit').attr('action', _url);
   });
  });
</script>
{% endblock %}

{% block float_right %}
    {%- if result.analyses %}
    <div class="well">
        <strong>{{ result.input }} {% trans %}is a possible form of ... {% endtrans %}</strong>
        <dl class="possible_analyses">
            {% for grouper, forms in result.analyses|groupby(0) %}
                <dt>{{ grouper }}</dt>
                <dd>
                    <ul class="possible_forms">
                {% for lemma, pos, tag in forms %}
                        <li>{{ tag|tagfilter(_from) }}</li>
                {% endfor %}
                    </ul>
                </dd>
            {% endfor %}
        </dl>
    </div>
    {%- endif -%}
{% endblock %}

{% block content_left %}
    <div class="row-fluid">
       <div class="span12">
           <form id="neahttadigisanit" class="form-inline pull-left"
               method="post"
               action="/{{ _from }}/{{ _to }}/">
           <div class="input-prepend input-append">
             <div class="btn-group">
               <button class="btn dropdown-toggle" data-toggle="dropdown">
                   <span class="val_name">{{ _from }}→{{ _to }}</span>
                 <span class="caret"></span>
               </button>
               <ul class="dropdown-menu" id="langpairs" role="menu"
                   data-for="target_lang">

                {# TODO: i18n #}
                {# TODO: dropdown select to language pair for form submit #}
                {% for iso_pair, names in language_pairs.iteritems() %}
                 <li class="selected{%- if iso_pair[0] == _from and iso_pair[1] == _to %} active{% endif -%}"><a tabindex="-1" href="#"
                         data-value="{{ iso_pair[0]}}{{ iso_pair[1] }}">
                        {% for lang, name in names.iteritems() %}
                            <span class="i18n" lang="{{ lang }}">{{ name[0] }} → {{ name[1] }}</span>
                        {% endfor %}
                    </a></li>
                {% endfor %}
               </ul>
             <input type="text" name="lookup"
                    autocorrect="off"
                    autocapitalize="off"
                    placeholder="{{ user_input }}"></input>
             <div class="btn-group">
               <button type="submit" class="btn" name="search">
                   <span>{% trans %}Search{% endtrans %}</span>
               </button>
             </div>
           </div>
           </div>
          <div id="results"></div>
        </form>
       </div>
       <br />
    </div>

    {% for lexeme in result.lexicon %}
    <div class="row-fluid lexeme">
        {% if lexeme.entries %}
            <div class="span12">
                {# This is the non-mobile version, otherwise we display it below #}
                {% set context = lexeme.entries.lookups[0].lemma_context %}
                {% if lexeme.paradigms %}
                    <div class="pull-right hidden-phone">
                        {% include 'detail_paradigm_dl.html' %}
                    </div>
                {% endif %}
                {% if lexeme.input[1] %}
                    <p class="lead">{{ lexeme.input[0] }} ({{ lexeme.input[1]|tagfilter(_from) }}) </p>
                {% else %}
                    <p class="lead">{{ lexeme.input[0] }} ({{ lexeme.entries.lookups[0].pos|tagfilter(_from) }}) </p>
                {% endif %}

                {% for tg in lexeme.entries.lookups %}
                    <ul class="meanings">
                        {% for mg in tg.meaningGroups %}
                            {% if mg.language and mg.language == _to %}
                                <li>{% include 'word_detail_li.html' %}</li>
                            {% elif not mg.language %}
                                <li>{% include 'word_detail_li.html' %}</li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                {% endfor %}

                {# This is the non-mobile version, otherwise we display it below #}
                {% set context = lexeme.entries.lookups[0].lemma_context %}
                {% if lexeme.paradigms %}
                    <div class="pull-left hidden-desktop hidden-tablet">
                        {% include 'detail_paradigm_dl.html' %}
                    </div>
                {% endif %}
            </div>


        {% endif %}
    </div>
    {% endfor %}

    {% if more_detail_link %}
        <p>
            <a href="/detail/{{ _from }}/{{ _to }}/{{ user_input }}.html">
                <span>{% trans %}More information about this word{% endtrans %}</span>
            </a>
        </p>
    {% endif %}

{% endblock %}
